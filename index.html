<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fiszki Electron</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%);
            min-height: 100vh;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .main-container {
            display: flex;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            box-sizing: border-box;
        }
        .center-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .right-sidebar {
            width: 350px;
            margin-left: 40px;
            padding-top: 40px;
        }
        h1 {
            margin-top: 40px;
            color: #2d3a4b;
            letter-spacing: 2px;
            font-size: 2.5rem;
        }
        #flashcard {
            perspective: 1200px;
            margin: 40px 0 20px 0;
            width: 350px;
            height: 220px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.7s cubic-bezier(.4,2,.6,1);
            transform-style: preserve-3d;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.18);
            border-radius: 18px;
            background: rgba(255,255,255,0.95);
            min-height: 220px;
        }
        .flip .card-inner {
            transform: rotateY(180deg);
        }
        .card-inner.flipping {
            pointer-events: none;
        }
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 18px;
            font-size: 1.3rem;
            padding: 30px;
            box-sizing: border-box;
        }
        .card-front {
            background: linear-gradient(120deg, #f6d365 0%, #fda085 100%);
            color: #2d3a4b;
            font-weight: 600;
        }
        .card-back {
            background: linear-gradient(120deg, #a1c4fd 0%, #c2e9fb 100%);
            color: #007bff;
            transform: rotateY(180deg);
            font-weight: bold;
            position: relative;
           
        }
        .card-content {
            text-align: center;
            max-height: 120px;
            overflow-y: auto;
            word-wrap: break-word;
            line-height: 1.4;
        }
        .buttons {
            display: flex;
            justify-content: center;
            gap: 18px;
        }
        button {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 12px 28px;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(102,126,234,0.12);
            transition: background 0.2s, transform 0.15s, box-shadow 0.2s;
        }
        button:hover {
            background: linear-gradient(90deg, #5a67d8 0%, #6b47b6 100%);
            transform: translateY(-2px) scale(1.04);
            box-shadow: 0 4px 16px rgba(102,126,234,0.18);
        }
        #delete:hover {
            background: linear-gradient(90deg, #c53030 0%, #a52a2a 100%) !important;
            box-shadow: 0 4px 16px rgba(229,62,62,0.18);
        }
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
                padding: 0 10px;
            }
            .right-sidebar {
                width: 100%;
                margin-left: 0;
                margin-top: 20px;
            }
            #flashcard { width: 95vw; height: 180px; }
            .card-inner { font-size: 1rem; padding: 10px; }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="center-content">
            <h1>Fiszki</h1>
            <div style="margin-bottom: 18px; display: flex; align-items: center; gap: 24px; justify-content: center; flex-wrap: wrap;">
                <div>
                    <label for="category-select" style="font-size:1.1rem; color:#2d3a4b; font-weight:500;">Kategoria:&nbsp;</label>
                    <select id="category-select" style="font-size:1.1rem; padding:6px 16px; border-radius:6px; border:1px solid #bbb;">
                        <option value="all">Wszystkie</option>
                    </select>
                </div>
                <div id="difficulty-selector" style="display: none;">
                    <label for="difficulty-select" style="font-size:1.1rem; color:#2d3a4b; font-weight:500;">Poziom:&nbsp;</label>
                    <select id="difficulty-select" style="font-size:1.1rem; padding:6px 16px; border-radius:6px; border:1px solid #bbb;">
                        <option value="all">Wszystkie</option>
                        <option value="≈Çatwy">≈Åatwy</option>
                        <option value="≈õredni">≈öredni</option>
                        <option value="trudny">Trudny</option>
                    </select>
                </div>
                <div>
                    <label for="learn-mode" style="font-size:1.1rem; color:#2d3a4b; font-weight:500; cursor:pointer;">
                        <input type="checkbox" id="learn-mode" style="transform:scale(1.3); margin-right:6px; vertical-align:middle;" /> Tryb nauki
                    </label>
                </div>
            </div>
            <div id="flashcard">
              <div class="card-inner">
                <div class="card-front">
                  <div id="question" class="card-content">≈Åadowanie...</div>
                </div>
                <div class="card-back">
                  <div id="answer" class="card-content"></div>
                </div>
              </div>
            </div>
            <div class="buttons" id="normal-buttons">
                <button id="prev">‚üµ Poprzednia</button>
                <button id="show">Poka≈º odpowied≈∫</button>
                <button id="next">Nastƒôpna ‚ü∂</button>
                <button id="delete" style="background: linear-gradient(90deg, #e53e3e 0%, #c53030 100%);">üóëÔ∏è Usu≈Ñ</button>
            </div>
            <form id="learn-form" style="display:none; margin:18px auto 0 auto; max-width:400px; background:#fff7; border-radius:12px; box-shadow:0 2px 8px #0001; padding:18px 18px; flex-direction:column; gap:12px; align-items:center;">
                <input id="user-answer" type="text" placeholder="Wpisz odpowied≈∫" autocomplete="off" style="padding:8px 12px; border-radius:6px; border:1px solid #bbb; font-size:1rem; width:90%; max-width:300px;" />
                <button type="submit" style="margin-top:8px;">Sprawd≈∫</button>
                <div id="learn-feedback" style="font-size:1.1rem; min-height:1.2em; margin-top:8px;"></div>
                <button type="button" id="learn-next" style="display:none; margin-top:8px;">Nastƒôpna ‚ü∂</button>
            </form>
        </div>
        <div class="right-sidebar">
            <form id="add-form" style="background:#fff7; border-radius:12px; box-shadow:0 2px 8px #0001; padding:22px 18px; display:flex; flex-direction:column; gap:12px;">
                <h2 style="margin:0 0 8px 0; color:#2d3a4b; font-size:1.3rem;">Dodaj nowƒÖ fiszkƒô</h2>
                <input id="new-question" type="text" placeholder="Pytanie" required style="padding:8px 12px; border-radius:6px; border:1px solid #bbb; font-size:1rem;" />
                <input id="new-answer" type="text" placeholder="Odpowied≈∫" required style="padding:8px 12px; border-radius:6px; border:1px solid #bbb; font-size:1rem;" />
                <select id="new-category" style="padding:8px 12px; border-radius:6px; border:1px solid #bbb; font-size:1rem;">
                    <option value="">Wybierz kategoriƒô</option>
                </select>
                <input id="new-category-custom" type="text" placeholder="lub wpisz nowƒÖ kategoriƒô" style="padding:8px 12px; border-radius:6px; border:1px solid #bbb; font-size:1rem;" />
                <select id="new-difficulty" style="padding:8px 12px; border-radius:6px; border:1px solid #bbb; font-size:1rem;">
                    <option value="">Wybierz poziom trudno≈õci</option>
                    <option value="≈Çatwy">≈Åatwy</option>
                    <option value="≈õredni">≈öredni</option>
                    <option value="trudny">Trudny</option>
                </select>
                <button type="submit" style="margin-top:8px;">Dodaj fiszkƒô</button>
                <div id="add-msg" style="color:#2d3a4b; font-size:1rem; min-height:1.2em;"></div>
            </form>
            <hr style="margin:32px 0 16px 0; border:none; border-top:1px solid #bbb3;" />
            <button id="import-btn" style="background: linear-gradient(90deg, #38b2ac 0%, #4299e1 100%); color:#fff; border:none; border-radius:8px; padding:12px 28px; font-size:1.1rem; font-weight:500; cursor:pointer; box-shadow:0 2px 8px rgba(56,178,172,0.12); margin-bottom:8px; width:100%;">üì• Importuj zestaw</button>
            <input type="file" id="import-file" accept="application/json" style="display:none;" />
            <div id="import-msg" style="color:#2d3a4b; font-size:1rem; min-height:1.2em;"></div>
        </div>
    </div>
    <script>
        let flashcards = [];
        let filtered = [];
        let current = 0;
        let categories = new Set();
        const flashcard = document.getElementById('flashcard');
        const cardInner = flashcard.querySelector('.card-inner');
        const questionDiv = document.getElementById('question');
        const answerDiv = document.getElementById('answer');
        const showBtn = document.getElementById('show');
        const nextBtn = document.getElementById('next');
        const prevBtn = document.getElementById('prev');
        const categorySelect = document.getElementById('category-select');
        const addForm = document.getElementById('add-form');
        const newQuestion = document.getElementById('new-question');
        const newAnswer = document.getElementById('new-answer');
        const newCategory = document.getElementById('new-category');
        const newCategoryCustom = document.getElementById('new-category-custom');
        const newDifficulty = document.getElementById('new-difficulty');
        const addMsg = document.getElementById('add-msg');
        const learnMode = document.getElementById('learn-mode');
        const normalButtons = document.getElementById('normal-buttons');
        const learnForm = document.getElementById('learn-form');
        const userAnswer = document.getElementById('user-answer');
        const learnFeedback = document.getElementById('learn-feedback');
        const learnNext = document.getElementById('learn-next');
        const deleteBtn = document.getElementById('delete');
        const importBtn = document.getElementById('import-btn');
        const importFile = document.getElementById('import-file');
        const importMsg = document.getElementById('import-msg');
        const difficultySelector = document.getElementById('difficulty-selector');
        const difficultySelect = document.getElementById('difficulty-select');

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        function updateCategorySelects() {
            // Do selecta w formularzu
            newCategory.innerHTML = '<option value="">Wybierz kategoriƒô</option>';
            categories.forEach(cat => {
                const opt = document.createElement('option');
                opt.value = cat;
                opt.textContent = cat.charAt(0).toUpperCase() + cat.slice(1);
                newCategory.appendChild(opt);
            });
        }

        window.electronAPI.getFlashcards().then(data => {
            flashcards = data;
            categories = new Set(flashcards.map(f => f.category));
            // Dodaj kategorie do selecta nad kartƒÖ
            categorySelect.innerHTML = '<option value="all">Wszystkie</option>';
            categories.forEach(cat => {
                const opt = document.createElement('option');
                opt.value = cat;
                opt.textContent = cat.charAt(0).toUpperCase() + cat.slice(1);
                categorySelect.appendChild(opt);
            });
            updateCategorySelects();
            filterAndShuffle();
            showFlashcard();
        });

        function filterAndShuffle() {
            const selected = categorySelect.value;
            const selectedDifficulty = difficultySelect.value;
            
            if (selected === 'all') {
                filtered = [...flashcards];
            } else {
                filtered = flashcards.filter(f => f.category === selected);
            }
            
            if (selectedDifficulty !== 'all') {
                filtered = filtered.filter(f => f.difficulty === selectedDifficulty);
            }
            
            shuffle(filtered);
            current = 0;
        }

        function setLearnMode(active) {
            if (active) {
                normalButtons.style.display = 'none';
                learnForm.style.display = 'flex';
                difficultySelector.style.display = 'block';
                flashcard.classList.remove('flip');
                userAnswer.value = '';
                learnFeedback.textContent = '';
                learnNext.style.display = 'none';
                userAnswer.disabled = false;
            } else {
                normalButtons.style.display = '';
                learnForm.style.display = 'none';
                difficultySelector.style.display = 'none';
            }
            showFlashcard();
        }

        function showFlashcard() {
            if (filtered.length === 0) {
                questionDiv.textContent = 'Brak fiszek w tej kategorii.';
                answerDiv.textContent = '';
                return;
            }
            
            const currentCard = filtered[current];
            questionDiv.textContent = currentCard.question;
            answerDiv.textContent = currentCard.answer;
            
            if (learnMode.checked) {
                userAnswer.value = '';
                learnFeedback.textContent = '';
                learnNext.style.display = 'none';
                userAnswer.disabled = false;
                userAnswer.focus();
            }
        }

        function flipCard() {
            cardInner.classList.add('flipping');
            flashcard.classList.add('flip');
            setTimeout(() => {
                cardInner.classList.remove('flipping');
            }, 700);
        }
        
        function unflipCard() {
            cardInner.classList.add('flipping');
            flashcard.classList.remove('flip');
            setTimeout(() => {
                cardInner.classList.remove('flipping');
            }, 700);
        }
        
        showBtn.onclick = () => {
            flipCard();
        };
        nextBtn.onclick = () => {
            unflipCard();
            setTimeout(() => {
                current = (current + 1) % filtered.length;
                showFlashcard();
            }, 200);
        };
        prevBtn.onclick = () => {
            unflipCard();
            setTimeout(() => {
                current = (current - 1 + filtered.length) % filtered.length;
                showFlashcard();
            }, 200);
        };
        deleteBtn.onclick = async () => {
            if (filtered.length === 0) return;
            
            if (confirm('Czy na pewno chcesz usunƒÖƒá tƒô fiszkƒô?')) {
                const currentFlashcard = filtered[current];
                const originalIndex = flashcards.findIndex(f => 
                    f.question === currentFlashcard.question && 
                    f.answer === currentFlashcard.answer && 
                    f.category === currentFlashcard.category &&
                    f.difficulty === currentFlashcard.difficulty
                );
                
                if (originalIndex !== -1) {
                    const result = await window.electronAPI.deleteFlashcard(originalIndex);
                    if (result.success) {
                        // Od≈õwie≈º fiszki
                        window.electronAPI.getFlashcards().then(data => {
                            flashcards = data;
                            categories = new Set(flashcards.map(f => f.category));
                            updateCategorySelects();
                            // Od≈õwie≈º select nad kartƒÖ
                            categorySelect.innerHTML = '<option value="all">Wszystkie</option>';
                            categories.forEach(cat => {
                                const opt = document.createElement('option');
                                opt.value = cat;
                                opt.textContent = cat.charAt(0).toUpperCase() + cat.slice(1);
                                categorySelect.appendChild(opt);
                            });
                            filterAndShuffle();
                            showFlashcard();
                        });
                    } else {
                        alert('B≈ÇƒÖd podczas usuwania fiszki.');
                    }
                }
            }
        };
        flashcard.onclick = (e) => {
            if (flashcard.classList.contains('flip') && !e.target.closest('button')) {
                unflipCard();
            }
        };
        categorySelect.onchange = () => {
            filterAndShuffle();
            showFlashcard();
            if (learnMode.checked) setLearnMode(true);
        };
        difficultySelect.onchange = () => {
            filterAndShuffle();
            showFlashcard();
        };

        learnMode.onchange = () => setLearnMode(learnMode.checked);

        addForm.onsubmit = async (e) => {
            e.preventDefault();
            const question = newQuestion.value.trim();
            const answer = newAnswer.value.trim();
            let category = newCategory.value;
            if (!category) category = newCategoryCustom.value.trim().toLowerCase();
            const difficulty = newDifficulty.value;
            if (!question || !answer || !category || !difficulty) {
                addMsg.textContent = 'Uzupe≈Çnij wszystkie pola.';
                return;
            }
            const newFlashcard = { question, answer, category, difficulty };
            const result = await window.electronAPI.addFlashcard(newFlashcard);
            if (result.success) {
                addMsg.textContent = 'Dodano fiszkƒô!';
                // Od≈õwie≈º fiszki i kategorie
                window.electronAPI.getFlashcards().then(data => {
                    flashcards = data;
                    categories = new Set(flashcards.map(f => f.category));
                    updateCategorySelects();
                    // Od≈õwie≈º select nad kartƒÖ
                    categorySelect.innerHTML = '<option value="all">Wszystkie</option>';
                    categories.forEach(cat => {
                        const opt = document.createElement('option');
                        opt.value = cat;
                        opt.textContent = cat.charAt(0).toUpperCase() + cat.slice(1);
                        categorySelect.appendChild(opt);
                    });
                    filterAndShuffle();
                    showFlashcard();
                });
                addForm.reset();
            } else {
                addMsg.textContent = 'B≈ÇƒÖd podczas zapisu.';
            }
        };

        learnForm.onsubmit = (e) => {
            e.preventDefault();
            const correct = filtered[current].answer.trim().toLowerCase();
            const user = userAnswer.value.trim().toLowerCase();
            if (!user) {
                learnFeedback.textContent = 'Wpisz odpowied≈∫.';
                return;
            }
            if (user === correct) {
                learnFeedback.textContent = '‚úÖ Poprawna odpowied≈∫!';
                learnFeedback.style.color = '#2e7d32';
            } else {
                learnFeedback.textContent = `‚ùå B≈Çƒôdna. Poprawna: ${filtered[current].answer}`;
                learnFeedback.style.color = '#c62828';
            }
            userAnswer.disabled = true;
            learnNext.style.display = '';
        };
        learnNext.onclick = () => {
            unflipCard();
            setTimeout(() => {
                current = (current + 1) % filtered.length;
                showFlashcard();
            }, 200);
        };

        importBtn.onclick = () => {
            importFile.value = '';
            importMsg.textContent = '';
            importFile.click();
        };
        importFile.onchange = async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            try {
                const text = await file.text();
                const imported = JSON.parse(text);
                if (!Array.isArray(imported)) throw new Error('Nieprawid≈Çowy format pliku.');
                // Sprawd≈∫ czy ka≈ºdy element ma wymagane pola
                for (const f of imported) {
                    if (!f.question || !f.answer || !f.category) throw new Error('Brak wymaganych p√≥l w jednej z fiszek.');
                    // Dodaj domy≈õlny poziom trudno≈õci je≈õli nie ma
                    if (!f.difficulty) f.difficulty = '≈õredni';
                }
                const result = await window.electronAPI.importFlashcards(imported);
                if (result.success) {
                    importMsg.textContent = 'Zaimportowano zestaw!';
                    window.electronAPI.getFlashcards().then(data => {
                        flashcards = data;
                        categories = new Set(flashcards.map(f => f.category));
                        updateCategorySelects();
                        categorySelect.innerHTML = '<option value="all">Wszystkie</option>';
                        categories.forEach(cat => {
                            const opt = document.createElement('option');
                            opt.value = cat;
                            opt.textContent = cat.charAt(0).toUpperCase() + cat.slice(1);
                            categorySelect.appendChild(opt);
                        });
                        filterAndShuffle();
                        showFlashcard();
                    });
                } else {
                    importMsg.textContent = 'B≈ÇƒÖd podczas importu.';
                }
            } catch (err) {
                importMsg.textContent = 'B≈ÇƒÖd: ' + err.message;
            }
        };
    </script>
</body>
</html>